<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Truy·ªán</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS QUAN TR·ªåNG: Logic ·∫©n hi·ªán Admin Mode */
        /* N·∫øu body KH√îNG c√≥ class 'is-admin-mode', th√¨ ·∫©n t·∫•t c·∫£ ph·∫ßn t·ª≠ '.admin-only' */
        body:not(.is-admin-mode) .admin-only {
            display: none !important;
        }
        
        /* Hi·ªáu ·ª©ng cho n√∫t g·∫°t */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #4f46e5;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #4f46e5;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <nav class="bg-white shadow-lg sticky top-0 z-[50]">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <a href="/" class="text-2xl font-bold text-indigo-600 flex items-center gap-2">
                    üìö WebTruyen
                </a>

                <div class="flex items-center space-x-4">
                    
                    <% if(user && user.role === 'admin') { %>
                        
                        <a href="/admin" class="admin-only flex items-center gap-1 text-indigo-600 font-bold hover:bg-indigo-50 px-3 py-2 rounded transition mr-2">
                            <span>‚öôÔ∏è</span> <span class="hidden md:inline">Qu·∫£n l√Ω</span>
                        </a>

                        <div class="flex items-center gap-2 mr-4 border-r pr-4 border-gray-300">
                            <span class="text-xs font-bold text-gray-500 uppercase hidden md:inline">Ch·∫ø ƒë·ªô Admin</span>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="admin-toggle" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300 left-0 top-0"/>
                                <label for="admin-toggle" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                    <% } %>

                    <% if(user) { %>
                        <span class="text-gray-700 hidden md:block text-sm">Xin ch√†o, <b><%= user.username %></b></span>
                        <a href="/logout" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition text-sm font-medium">ƒêƒÉng xu·∫•t</a>
                    <% } else { %>
                        <a href="/login" class="text-gray-600 hover:text-indigo-600 font-medium">ƒêƒÉng nh·∫≠p</a>
                        <a href="/register" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">ƒêƒÉng k√Ω</a>
                    <% } %>
                </div>
            </div>
        </div>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const adminToggle = document.getElementById('admin-toggle');
            const body = document.body;

            // 1. Ki·ªÉm tra tr·∫°ng th√°i c≈© trong LocalStorage khi t·∫£i trang
            const isAdminMode = localStorage.getItem('adminMode') === 'true';

            // 2. √Åp d·ª•ng tr·∫°ng th√°i
            if (isAdminMode) {
                body.classList.add('is-admin-mode');
                if(adminToggle) adminToggle.checked = true;
            } else {
                body.classList.remove('is-admin-mode');
                if(adminToggle) adminToggle.checked = false;
            }

            // 3. L·∫Øng nghe s·ª± ki·ªán click n√∫t g·∫°t
            if(adminToggle) {
                adminToggle.addEventListener('change', function() {
                    if(this.checked) {
                        body.classList.add('is-admin-mode');
                        localStorage.setItem('adminMode', 'true');
                    } else {
                        body.classList.remove('is-admin-mode');
                        localStorage.setItem('adminMode', 'false');
                    }
                });
            }
        });
    </script>
</body>
</html>