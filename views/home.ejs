<%- include('partials/header') %>

<div class="bg-gray-100 min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div class="flex items-center justify-between mb-8 border-l-4 border-indigo-600 pl-4">
            <h1 class="text-3xl font-bold text-gray-900">
                Truy·ªán M·ªõi C·∫≠p Nh·∫≠t
            </h1>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <% stories.forEach(story => { %>
                <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition overflow-hidden border border-gray-100 flex flex-row h-48 relative group">
                    
                    <div class="absolute top-0 left-0 z-10">
                        <% if(story.status === 'ƒê√£ ho√†n th√†nh') { %>
                            <span class="bg-green-600 text-white text-[10px] font-bold px-2 py-1 rounded-br-lg shadow-sm uppercase tracking-wide">
                                Full
                            </span>
                        <% } else { %>
                            <span class="bg-blue-600 text-white text-[10px] font-bold px-2 py-1 rounded-br-lg shadow-sm uppercase tracking-wide">
                                ƒêang ra
                            </span>
                        <% } %>
                    </div>

                    <div class="w-1/3 min-w-[120px] max-w-[150px] relative overflow-hidden">
                        <a href="/story/<%= story.id %>" class="block h-full">
                            <img src="<%= story.cover || 'https://via.placeholder.com/150' %>" 
                                 class="w-full h-full object-cover transform group-hover:scale-110 transition duration-500">
                        </a>
                    </div>

                    <div class="w-2/3 p-4 flex flex-col justify-between">
                        <div>
                            <a href="/story/<%= story.id %>" class="block">
                                <h3 class="text-lg font-bold text-gray-800 hover:text-indigo-600 transition line-clamp-1 mb-1" title="<%= story.title %>">
                                    <%= story.title %>
                                </h3>
                            </a>

                            <p class="text-sm text-gray-500 line-clamp-3 leading-relaxed text-justify font-serif">
                            <% 
                                // Logic: ∆Øu ti√™n hi·ªÉn th·ªã n·ªôi dung ch∆∞∆°ng m·ªõi nh·∫•t
                                let previewText = "";
                                
                                if (story.latest_content) {
                                    // N·∫øu c√≥ ch∆∞∆°ng m·ªõi: L·∫•y 150 k√Ω t·ª± ƒë·∫ßu ti√™n
                                    previewText = "üìñ Tr√≠ch ƒëo·∫°n: " + story.latest_content.substring(0, 150) + "...";
                                } else {
                                    // N·∫øu ch∆∞a c√≥ ch∆∞∆°ng: L·∫•y m√¥ t·∫£
                                    previewText = story.description ? story.description : 'Ch∆∞a c√≥ m√¥ t·∫£...';
                                }
                            %>
                            <%= previewText %>
                        </p>
                        </div>

                        <div class="mt-2 flex justify-end">
                            <a href="/story/<%= story.id %>" class="text-xs font-semibold text-indigo-600 hover:text-indigo-800 flex items-center gap-1 group-hover:translate-x-1 transition">
                                ƒê·ªçc ngay <span>&rarr;</span>
                            </a>
                        </div>
                    </div>
                </div>
            <% }) %>

        </div>
        <div class="mt-10 flex justify-center">
            <nav class="inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <% if (currentPage > 1) { %>
                    <a href="/?page=<%= currentPage - 1 %>" class="relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <span class="sr-only">Previous</span>
                        ‚¨Ö Tr∆∞·ªõc
                    </a>
                <% } else { %>
                    <span class="relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed">
                        ‚¨Ö Tr∆∞·ªõc
                    </span>
                <% } %>

                <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-indigo-50 text-sm font-medium text-indigo-600">
                    Trang <%= currentPage %> / <%= totalPages %>
                </span>

                <% if (currentPage < totalPages) { %>
                    <a href="/?page=<%= currentPage + 1 %>" class="relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        Sau ‚û°
                    </a>
                <% } else { %>
                    <span class="relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed">
                        Sau ‚û°
                    </span>
                <% } %>
            </nav>
        </div>

    </div>
</div>

<%- include('partials/footer') %>